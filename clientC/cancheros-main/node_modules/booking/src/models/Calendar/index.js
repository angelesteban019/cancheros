
import moment from 'moment';
import Event  from '../Event';

const invalidRangeError = new ReferenceError("Invalid range of dates");

class Calendar {

  constructor({ startTime = moment(), endTime = moment().add(1, 'year') } = {}) {

    if (startTime.isAfter(endTime)) {

      throw invalidRangeError;

    } else {

      this._startTime = startTime;
      this._endTime = endTime;
      this._events = new Array();
    }
  }

  isValidEvent(event) {
    let isValid = event.isBetween(this._startTime, this._endTime);

    for (let i = 0; i < this._events.length && isValid; i++) {
      let e = this._events[i];
      isValid = !e.collide(event);
    }

    return isValid;
  }

  addEvent(event) {
    if (this.isValidEvent(event)) {
      this._events.push(event);
    }
  }

  get startTime() {
    return this._startTime.calendar();
  }

  get endTime() {
    return this._endTime.calendar();
  }

  get events() {
    return this._events;
  }
}

export default Calendar;
